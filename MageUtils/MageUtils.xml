<?xml version="1.0" encoding="utf-8"?>
<Ui xmlns="http://www.blizzard.com/wow/ui/">

    <!-- MageUtils Teleport Frame -->
    <Frame name="MageUtilsTeleportFrame" hidden="true" movable="true" enableMouse="true">
        <Size>
            <AbsDimension x="300" y="150"/>
        </Size>
        <Anchors>
            <Anchor point="CENTER"/>
        </Anchors>
        <Backdrop bgFile="Interface\DialogFrame\UI-DialogBox-Background" 
                  edgeFile="Interface\DialogFrame\UI-DialogBox-Border" 
                  tile="true" tileSize="32" edgeSize="32" 
                  insets="5,5,5,5"/>
        <Frames>
            <!-- Title Bar (Optional) -->
            <Frame name="$parentTitle" inherits="UIPanelButtonTemplate">
                <Size>
                    <AbsDimension x="290" y="24"/>
                </Size>
                <Anchors>
                    <Anchor point="TOP" relativePoint="TOP" x="0" y="-5"/>
                </Anchors>
                <Backdrop bgFile="Interface\DialogFrame\UI-DialogBox-Header" 
                          edgeFile="" 
                          tile="false" tileSize="0" edgeSize="0" 
                          insets="0,0,0,0"/>
            </Frame>

            <!-- Teleport to Stormwind Button -->
            <Button name="$parentPortSW" inherits="SecureActionButtonTemplate">
                <Size>
                    <AbsDimension x="50" y="50"/>
                </Size>
                <Anchors>
                    <Anchor point="CENTER" relativePoint="CENTER" x="0" y="0"/>
                </Anchors>
                <Layers>
                    <Layer level="BACKGROUND">
                        <Texture name="$parentTelSWTexture" file="Interface\Icons\Spell_Arcane_PortalStormwind"/>
                    </Layer>
                </Layers>
                <Scripts>
                    <OnLoad>
                        local swport = GetSpellInfo(10059) <!-- Teleport: Stormwind -->
                        if swport ~= nil then
                            self:SetAttribute("type1", "spell")
                            self:SetAttribute("spell", swport)
                        end
                    </OnLoad>
                    <OnEnter>
                        GameTooltip:SetOwner(self, ANCHOR_TOPLEFT)
                        GameTooltip:AddLine("Portal: Stormwind")
                        GameTooltip:Show()
                    </OnEnter>
                    <OnLeave>
                        GameTooltip:Hide()
                    </OnLeave>
                </Scripts>
            </Button>
        </Frames>

        <!-- Make the frame draggable -->
        <Scripts>
            <OnLoad>
                self:SetMovable(true)
                self:RegisterForDrag("LeftButton")
                -- Restore position if saved
                if MageUtilsDB.TeleportFramePosition then
                    self:ClearAllPoints()
                    self:SetPoint(
                        MageUtilsDB.TeleportFramePosition.point,
                        UIParent,
                        MageUtilsDB.TeleportFramePosition.relativePoint,
                        MageUtilsDB.TeleportFramePosition.xOfs,
                        MageUtilsDB.TeleportFramePosition.yOfs
                    )
                end
            </OnLoad>
            <OnDragStart>
                self:StartMoving()
            </OnDragStart>
            <OnDragStop>
                self:StopMovingOrSizing()
                -- Save the new position to the database
                local point, relativeTo, relativePoint, xOfs, yOfs = self:GetPoint()
                MageUtilsDB.TeleportFramePosition = {
                    point = point,
                    relativePoint = relativePoint,
                    xOfs = xOfs,
                    yOfs = yOfs,
                }
            </OnDragStop>
        </Scripts>
    </Frame>

</Ui>
