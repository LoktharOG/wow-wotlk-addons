<?xml version="1.0" encoding="utf-8"?>
<Ui xmlns="http://www.blizzard.com/wow/ui/">

    <!-- MageUtils Teleport Frame -->
    <Frame name="MageUtilsTeleportFrame" hidden="true" movable="true" enableMouse="true">
        <Size>
            <AbsDimension x="300" y="150"/>
        </Size>
        <Anchors>
            <Anchor point="CENTER"/>
        </Anchors>
        <Backdrop bgFile="Interface\DialogFrame\UI-DialogBox-Background" edgeFile="Interface/Tooltips/UI-Tooltip-Border" tile="true">
        <Frames>
            <!-- Teleport to Stormwind Button -->
            <Button name="$parentPortSW" inherits="SecureActionButtonTemplate">
                <Size>
                    <AbsDimension x="20" y="20"/>
                </Size>
                <Anchors>
                    <Anchor point="TOPLEFT" x="10" y="-20"/>
                </Anchors>
                <Layers>
                    <Layer level="BACKGROUND">
                        <Texture name="$parentTelSWTexture" file="Interface\Icons\Spell_Arcane_PortalStormwind"/>
                    </Layer>
                </Layers>
                <Scripts>
                    <OnLoad>
                        local swport = GetSpellInfo(10059) <!-- Teleport: Stormwind -->
                        if swport ~= nil then
                            self:SetAttribute("type1", "spell")
                            self:SetAttribute("spell", swport)
                        end
                    </OnLoad>
                    <OnEnter>
                        GameTooltip:SetOwner(self, ANCHOR_TOPLEFT)
                        GameTooltip:AddLine("Portal: Stormwind")
                        GameTooltip:Show()
                    </OnEnter>
                    <OnLeave>
                        GameTooltip:Hide()
                    </OnLeave>
                </Scripts>
            </Button>

            <Button name="$parentHearth" inherits="SecureActionButtonTemplate">
                <Size>
                    <AbsDimension x="20" y="20"/>
                </Size>
                <Anchors>
                    <Anchor point="BOTTOM">
                        <Offset>
                            <AbsDimension x="-70" y="10"/>
                        </Offset>
                    </Anchor>
                </Anchors>
                <Layers>
                    <Layer level="BACKGROUND">
                        <Texture name="$parentTelDalTexture" file="Interface\Icons\inv_misc_rune_01"/>
                    </Layer>
                </Layers>
                <Scripts>
                    <OnLoad>
                        this:SetAttribute("type1", "item")
                        this:SetAttribute("item", GetItemInfo(6948))
                    </OnLoad>
                    <OnEnter>
                        GameTooltip:SetOwner(this, ANCHOR_TOPLEFT);
                        GameTooltip:AddLine("Hearthstone")
                        GameTooltip:Show()
                    </OnEnter>
                    <OnLeave>
                        GameTooltip:Hide()
                    </OnLeave>
                </Scripts>
            </Button>     
            
            <Button name="$parentClose" inherits="OptionsButtonTemplate" text="Close">
                    <Size>
                    <AbsDimension x="60" y="18"/>
                    </Size>
                    <Anchors>
                        <Anchor point="BOTTOM">
                            <Offset>
                            <AbsDimension x="-20" y="10"/>
                            </Offset>
                        </Anchor>
                    </Anchors>
                    <Scripts>
                        <OnClick>
                            MageUtilsTeleportFrame:Hide();
                        </OnClick>
                    </Scripts>
            </Button>
        </Frames>

        <!-- Make the frame draggable -->
        <Scripts>
            <OnLoad>
                self:SetMovable(true)
                self:RegisterForDrag("LeftButton")
                -- Restore position if saved
                if MageUtilsDB.TeleportFramePosition then
                    self:ClearAllPoints()
                    self:SetPoint(
                        MageUtilsDB.TeleportFramePosition.point,
                        UIParent,
                        MageUtilsDB.TeleportFramePosition.relativePoint,
                        MageUtilsDB.TeleportFramePosition.xOfs,
                        MageUtilsDB.TeleportFramePosition.yOfs
                    )
                end
            </OnLoad>
            <OnDragStart>
                self:StartMoving()
            </OnDragStart>
            <OnDragStop>
                self:StopMovingOrSizing()
                -- Save the new position to the database
                local point, relativeTo, relativePoint, xOfs, yOfs = self:GetPoint()
                MageUtilsDB.TeleportFramePosition = {
                    point = point,
                    relativePoint = relativePoint,
                    xOfs = xOfs,
                    yOfs = yOfs,
                }
            </OnDragStop>
        </Scripts>
    </Frame>

</Ui>
